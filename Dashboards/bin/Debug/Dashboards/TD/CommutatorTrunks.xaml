<Page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:std="clr-namespace:StandartObjectLibrary;assembly=StandartObjectLibrary"
      xmlns:ext="clr-namespace:ExtendedObjectsLibrary;assembly=ExtendedObjectsLibrary">

  <Page.Resources>
    <XmlDataProvider x:Key="data" Source="http://172.27.129.37/SCOMSchema/Service.svc/GetSchema?name=NSS%20Enviroment%201%20MSC%20Data" XPath="/CommutatorData/RawData/OfficeDirections/OfficeDirection" />

    <Style x:Key="trafficListBox" TargetType="ListBox">
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="ListBox">
            <ControlTemplate.Resources>
              <Style TargetType="ListBoxItem">
                <Setter Property="MinWidth" Value="480" />
                <Setter Property="MaxWidth" Value="480" />
                <Setter Property="MinHeight" Value="500" />
                <Setter Property="MaxHeight" Value="500" />

                <Setter Property="Template">
                  <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                      <Grid>
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="30" />
                          <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" Text="{Binding XPath=@totalMinutes}" Foreground="White" FontSize="12px" TextAlignment="Right" Margin="0,0,5,0"/>
                        <TextBlock Grid.Column="1" Text="{Binding XPath=@name}" Foreground="White" FontSize="12px"/>
                      </Grid>
                    </ControlTemplate>
                  </Setter.Value>
                </Setter>
              </Style>
            </ControlTemplate.Resources>
            <StackPanel IsItemsHost="True" 
                        Orientation="Vertical"
                        MaxWidth="{Binding ElementName=border, Path=ActualWidth}"/>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>
    
    <Style x:Key="layoutListBox" TargetType="ListBox">
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="ListBox">
            <ControlTemplate.Resources>
              <Style TargetType="ListBoxItem">
                <Setter Property="MinWidth" Value="480" />
                <Setter Property="MaxWidth" Value="480" />
                <Setter Property="MinHeight" Value="500" />
                <Setter Property="MaxHeight" Value="500" />

                <Setter Property="Template">
                  <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                      <std:Group Margin="10" HeaderContent="{Binding XPath=@name}">
                        <Canvas>
                          <TextBlock Foreground="White" Text="Channels Load" FontSize="16" Canvas.Left="3" Canvas.Top="0" />
                          <TextBlock Foreground="Red" Text="Busy" FontSize="16" Canvas.Left="80" Canvas.Top="25" />
                          <TextBlock Foreground="Lime" Text="Idle" FontSize="16" Canvas.Left="80" Canvas.Top="130" />

                          <std:Cylinder FillSource="{StaticResource incommingColorCollection}" Value="{Binding XPath=Counters/Occupied[@counter\=\'percent\']}" Canvas.Left="14" Canvas.Top="33" Width="63" Height="118"/>
                          <ext:GraphicControl DataSource="{Binding XPath=GraphicData/Graphic}" Canvas.Left="130" Canvas.Top="25" Width="320" Height="250" />

                          <Line X1="0" Y1="165" X2="130" Y2="165" Stroke="White"/>

                          <TextBlock Foreground="Lime" Canvas.Left="10" Canvas.Top="170" FontSize="15px" Text="Idle"/>
                          <TextBlock Foreground="Lime" Canvas.Left="80" Canvas.Top="170" FontSize="15px" Text="{Binding XPath=Counters/Idle}"/>

                          <TextBlock Foreground="Yellow" Canvas.Left="10" Canvas.Top="190" FontSize="15px" Text="Occupied" />
                          <TextBlock Foreground="Yellow" Canvas.Left="80" Canvas.Top="190" FontSize="15px" Text="{Binding XPath=Counters/Occupied}"/>

                          <TextBlock Foreground="Red" Canvas.Left="10" Canvas.Top="210" FontSize="15px" Text="Blocked" />
                          <TextBlock Foreground="Red" Canvas.Left="80" Canvas.Top="210" FontSize="15px" Text="{Binding XPath=Counters/Blocked}"/>

                          <Line X1="0" Y1="243" X2="130" Y2="243" Stroke="White"/>

                          <TextBlock Foreground="White" Canvas.Left="10" Canvas.Top="245" FontSize="15px" Text="Total" />
                          <TextBlock Foreground="White" Canvas.Left="80" Canvas.Top="245" FontSize="15px" Text="{Binding XPath=Counters/Total}" />

                          <Line X1="0" Y1="285" X2="480" Y2="285" Stroke="#FF6495ED"/>

                          <TextBlock Canvas.Left="0" Canvas.Top="290" Width="480"
                           Text="Interconnect Traffic" FontSize="14" FontWeight="Bold" 
                           TextAlignment="Center" HorizontalAlignment="Center" />

                          <std:ProgressBar Canvas.Left="10" Canvas.Top="310" Width="440" Height="16" 
                                 Value="{Binding XPath=PercentSecondsIncoming}">
                            <std:ProgressBar.FillSource>
                              <std:SolidColorFill>
                                <std:ColorInterval Value="0" Color="Red" Blinking="True" BlinkingSpeedRatio="2" />
                                <std:ColorInterval Value="10" Color="Red" />
                                <std:ColorInterval Value="30" Color="Yellow" />
                                <std:ColorInterval Value="50" Color="Green" />
                              </std:SolidColorFill>
                            </std:ProgressBar.FillSource>
                          </std:ProgressBar>

                          <TextBlock Text="[m] Incomming Traffic" Foreground="LightBlue" Canvas.Left="18" Canvas.Top="330" FontSize="14" FontStyle="Italic" />
                          <ListBox Canvas.Left="11" Canvas.Top="350" Style="{StaticResource trafficListBox}" ItemsSource="{Binding XPath=IncomingTraffic/Direction[@position &lt;\= 5 and @totalMinutes !\= 0]}" />
                          
                          <TextBlock Text="[m] Outgoing Traffic" Foreground="LightBlue" Canvas.Left="300" Canvas.Top="330" FontSize="14" FontStyle="Italic" />
                          <ListBox Canvas.Left="294" Canvas.Top="350" Style="{StaticResource trafficListBox}" ItemsSource="{Binding XPath=OutgoingTraffic/Direction[@position &lt;\= 5 and @totalMinutes !\= 0]}" />
                        </Canvas>
                      </std:Group>
                    </ControlTemplate>
                  </Setter.Value>
                </Setter>
              </Style>
            </ControlTemplate.Resources>
            
            <Border x:Name="border">
              <UniformGrid IsItemsHost="True" 
                           Columns="4"
                           MaxWidth="{Binding ElementName=border, Path=ActualWidth}"/>
            </Border>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>
  </Page.Resources>

  <Viewbox Stretch="Uniform">
    <Grid Width="2000">
      <ListBox Style="{StaticResource layoutListBox}" ItemsSource="{Binding Source={StaticResource data}}" />
    </Grid>
  </Viewbox>
</Page>